<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalle del producto</title>
  <link rel="icon" href="img/logomaxicompras.webp" type="image/webp">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="styleproductos.css" />
</head>
<body>
<!-- Barra superior -->
<div class="top-bar">
  <span><img src="img/camion.webp" alt="EnvÃ­o" class="icono"> EnvÃ­o Gratis a todo Colombia</span>
  <span><img src="img/telefono.webp" alt="WhatsApp" class="icono"> Asesoramiento vÃ­a Whatsapp</span>
  <span><img src="img/importadores.webp" alt="Calidad" class="icono"> Somos Importadores</span>
</div>

<!-- Encabezado -->
<header class="main-header">
  <div class="logo">
    <a href="index.html">
      <img src="img/logomaxicompras.webp" alt="Logo MaxiCompras" />
    </a>
  </div>

  <div class="barra-busqueda" id="barraBusqueda">
    <input type="text" id="input-busqueda" placeholder="Buscar productos..." />
  </div>

  <div class="icons">
    <img src="img/search.webp" alt="Buscar" id="iconoBusqueda" />
    <div class="carrito-icono">
      <img src="./img/cart.webp" alt="Carrito" />
      <span class="contador-carrito" id="contadorCarrito"></span>
    </div>
  </div>
</header>
<div id="resultados-busqueda" class="resultados-busqueda" style="display:none; flex-wrap: wrap; gap: 1rem; padding: 1rem;"></div>


<!-- ðŸ”¸ Producto -->
<section class="producto-container">
  <div class="producto-imagen">
    <img id="imagen-principal" src="" alt="Producto principal" /> 
  </div>


  <div class="producto-detalles">
    <h1 id="nombre-producto"></h1>
    <div class="estrellas">â˜…â˜…â˜…â˜…â˜… (5)</div>
    <div class="precios">
      <span id="precio-anterior" class="precio-original"></span>
      <span id="precio-actual" class="precio-descuento"></span>
      <span id="descuento" class="badge-descuento"></span>
    </div>

 <img src="img/tiendalider.png" alt="Tienda LÃ­der Platinum" class="img-tienda-lider">
   
    <div class="botones">
      <a id="btn-comprar" class="btn-comprar">Comprar ahora</a>
      <button class="btn-carrito">AÃ±adir al carrito</button>
    </div>

  </div>
  <div class="miniaturas" id="miniaturas"></div>
  <!-- Imagen centrada encima de las descripciones -->
<div style="text-align: center; margin-top: 20px; margin-bottom: 10px;">
</div>
</section>


<script>
  const params = new URLSearchParams(window.location.search);
  const slug = params.get("slug");

  if (!slug) {
    window.location.href = "all.html";
  }

  // Primero: cargar productos.json para info general
  fetch("productos.json")
    .then(res => res.json())
    .then(productos => {
      const producto = productos.find(p => p.slug === slug);
      if (!producto) return;

      const { imagenes, nombre, precio } = producto;
      const precioAnterior = producto.precio_anterior || Math.round(precio * 1.5);
      const descuento = Math.round(100 - (precio / precioAnterior) * 100);

      document.getElementById("imagen-principal").src = imagenes[0];
      document.getElementById("nombre-producto").textContent = nombre;
      document.getElementById("precio-anterior").textContent = "$" + precioAnterior.toLocaleString("es-CO");
      document.getElementById("precio-actual").textContent = "$" + precio.toLocaleString("es-CO");
      document.getElementById("descuento").textContent = `Ahorra ${descuento}%`;

      fetch("descripciones.json")
        .then(res => res.json())
        .then(extraidos => {
          const extra = extraidos.find(p => p.producto.toLowerCase().trim() === nombre.toLowerCase().trim());

if (Array.isArray(extra.imagenes)) {
  const miniaturas = document.getElementById("miniaturas");
  let indiceActual = 0;
  let intervaloCambio;
  let imagenesParaMostrar = [producto.imagenes[0], ...extra.imagenes];

  const esMovil = window.innerWidth <= 768;

  if (!esMovil) {
    // Mostrar miniaturas en pantallas grandes
    imagenesParaMostrar.forEach((src, index) => {
      const thumb = document.createElement("img");
      thumb.src = src;
      thumb.alt = `Miniatura ${index + 1}`;
      if (index === 0) thumb.classList.add("activa");

      thumb.addEventListener("click", () => {
        clearInterval(intervaloCambio);
        const principal = document.getElementById("imagen-principal");
principal.src = src;
principal.style.borderRadius = "20px"; // Fuerza el estilo siempre

        miniaturas.querySelectorAll("img").forEach(img => img.classList.remove("activa"));
        thumb.classList.add("activa");

        // Reiniciar autoplay mÃ¡s lento
        intervaloCambio = setInterval(() => {
          indiceActual = (indiceActual + 1) % imagenesParaMostrar.length;
          const nuevaSrc = imagenesParaMostrar[indiceActual];
          document.getElementById("imagen-principal").src = nuevaSrc;

          miniaturas.querySelectorAll("img").forEach((img, idx) => {
            img.classList.toggle("activa", idx === indiceActual);
          });
        }, 5000);
      });

      miniaturas.appendChild(thumb);
    });
  }

  // Siempre correr autoplay (tanto en mÃ³vil como en escritorio)
  intervaloCambio = setInterval(() => {
    indiceActual = (indiceActual + 1) % imagenesParaMostrar.length;
    const nuevaSrc = imagenesParaMostrar[indiceActual];
    document.getElementById("imagen-principal").src = nuevaSrc;

    if (!esMovil) {
      miniaturas.querySelectorAll("img").forEach((img, idx) => {
        img.classList.toggle("activa", idx === indiceActual);
      });
    }
  }, 4000);

// ðŸ’¡ Nueva lÃ³gica para descripciones estructuradas
if (Array.isArray(extra.descripciones)) {
  const descripcionDiv = document.createElement("div");
  descripcionDiv.className = "descripcion-estructurada";
  descripcionDiv.style.marginTop = "30px";
  descripcionDiv.style.lineHeight = "1.7";
  descripcionDiv.style.fontSize = "16px";

  const esMovil = window.innerWidth <= 768;

  extra.descripciones.forEach(item => {
    if (item.titulo) {
      const h3 = document.createElement("h3");
      h3.textContent = item.titulo;
      h3.style.fontWeight = "bold";
      h3.style.textAlign = "center";
      h3.style.lineHeight = "1.4";
      h3.style.fontSize = esMovil ? "1.25rem" : "1.3rem";
      h3.style.marginTop = esMovil ? "40px" : "25px";
      h3.style.marginBottom = esMovil ? "12px" : "8px";
      descripcionDiv.appendChild(h3);
    }

    if (item.texto) {
      const p = document.createElement("p");
      p.textContent = item.texto;
      p.style.textAlign = "center";
      p.style.lineHeight = "1.6";
      p.style.marginBottom = esMovil ? "18px" : "16px";
      descripcionDiv.appendChild(p);
    }
  });

  document.querySelector(".producto-container").appendChild(descripcionDiv);
}
// ðŸ”½ Te podrÃ­a interesar...
const relacionadosDiv = document.createElement("div");
relacionadosDiv.className = "relacionados";
relacionadosDiv.style.marginTop = "50px";

const titulo = document.createElement("h2");
titulo.textContent = "Te podrÃ­a interesar...";
titulo.style.textAlign = "center";
titulo.style.marginBottom = "25px";
titulo.style.fontSize = "1.6rem";
titulo.style.fontWeight = "bold";
relacionadosDiv.appendChild(titulo);

const contenedor = document.createElement("div");
contenedor.className = "productos-relacionados";
contenedor.style.display = "grid";
contenedor.style.gridTemplateColumns = "repeat(auto-fit, minmax(180px, 1fr))";
contenedor.style.gap = "1rem";
contenedor.style.padding = "0 1rem";

let sugerencias = productos.filter(p => p.slug !== slug);
sugerencias = sugerencias.sort(() => 0.5 - Math.random()).slice(0, 4); // 4 productos aleatorios

sugerencias.forEach(p => {
  const card = document.createElement("div");
  card.innerHTML = `
    <a href="producto.html?slug=${p.slug}" style="text-decoration:none;color:inherit;">
      <img src="${p.imagenes[0]}" alt="${p.nombre}" style="width:100%;border-radius:10px;">
      <h3 style="font-size:1rem;margin-top:0.5rem;">${p.nombre}</h3>
      <p style="color:#e91e63;font-weight:bold;">$${p.precio.toLocaleString("es-CO")}</p>
    </a>
  `;
  contenedor.appendChild(card);
});

relacionadosDiv.appendChild(contenedor);
document.querySelector(".producto-container").appendChild(relacionadosDiv);

}});


      document.querySelector(".btn-carrito").addEventListener("click", () => {
        const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
        const existente = carrito.find(p => p.slug === producto.slug);
        if (existente) {
          existente.cantidad += 1;
        } else {
          carrito.push({
            slug: producto.slug,
            nombre,
            imagen: imagenes[0],
            precio,
            cantidad: 1
          });
        }
        localStorage.setItem("carrito", JSON.stringify(carrito));
        const mensaje = document.getElementById("mensaje-carrito");
        mensaje.classList.add("mostrar");
        setTimeout(() => mensaje.classList.remove("mostrar"), 3000);
        actualizarContadorCarrito();
      });

   document.getElementById("btn-comprar").addEventListener("click", () => {
  // ðŸ§¹ Limpia el carrito por si venÃ­a de ahÃ­
  localStorage.removeItem("carrito");

  const productoSeleccionado = {
    nombre: nombre,
    precio: precio,
    imagen: imagenes[0]
  };

  // Guarda el producto individual
  localStorage.setItem("productoSeleccionado", JSON.stringify(productoSeleccionado));

  // Redirige al formulario
  window.location.href = "formulario.html";
});

    });
    
    </script>

<!-- ðŸ”» Script: top-bar mÃ³vil -->
<script>
  const mensajes = document.querySelectorAll('.top-bar span');
  let actual = 0;

  function mostrarMensaje() {
    mensajes.forEach((msg, i) => {
      msg.classList.toggle('activo', i === actual);
    });
    actual = (actual + 1) % mensajes.length;
  }

  if (window.innerWidth <= 768) {
    mostrarMensaje();
    setInterval(mostrarMensaje, 4000);
  }
</script>

<div id="mensaje-carrito" class="mensaje-flotante">Producto aÃ±adido al carrito</div>


<!--funcion carro y busqueda-->

<script>
   let productosCargados = [];
      fetch('productos.json')
  .then(res => res.json())
  .then(data => {
    productosCargados = data;
  })
  .catch(err => {
    console.error('Error cargando productos:', err);
  });
</script>
 
<script>
const iconoBusqueda = document.getElementById("iconoBusqueda");
const inputBusqueda = document.getElementById("input-busqueda");
const resultadosBusqueda = document.getElementById("resultados-busqueda");

let buscadorActivo = false;

iconoBusqueda.addEventListener("click", () => {
  buscadorActivo = !buscadorActivo;

  if (buscadorActivo) {
    inputBusqueda.style.display = "block";
    inputBusqueda.focus();
  } else {
    inputBusqueda.style.display = "none";
    inputBusqueda.value = "";
    resultadosBusqueda.style.display = "none";
  }
});


inputBusqueda.addEventListener("input", () => {
  const texto = inputBusqueda.value.trim().toLowerCase();
  resultadosBusqueda.innerHTML = "";

  if (!texto) {
    resultadosBusqueda.style.display = "none";
    return;
  }

  const filtrados = productosCargados.filter(p =>
    p.nombre.toLowerCase().includes(texto)
  );

  if (filtrados.length === 0) {
    resultadosBusqueda.innerHTML = "<p style='padding:1rem;'>No se encontraron productos.</p>";
  } else {
    filtrados.forEach(producto => {
      const div = document.createElement("div");
      div.className = "producto-card";
      div.innerHTML = `
        <a href="producto.html?slug=${producto.slug}">
          <img src="${producto.imagenes[0]}" alt="${producto.nombre}" style="width:100%;border-radius:5px;" />
          <h3>${producto.nombre}</h3>
          <p><strong>$${producto.precio.toLocaleString('es-CO')}</strong></p>
        </a>
      `;
      resultadosBusqueda.appendChild(div);
    });
  }

  resultadosBusqueda.style.display = "flex";
});


</script>


<!-- ðŸ”¹ MINI CARRITO -->
<div id="mini-carrito" class="modal-carrito oculto">
  <div class="contenido-carrito">
    <h2>Tu Carrito</h2>
    <div id="mini-carrito-items"></div>
    <div class="mini-carrito-footer">
      <button onclick="window.location.href='cart.html'" class="btn-ir-carrito">Ir al carrito</button>
    </div>
  </div>
</div>
<div id="fondo-oscuro-carrito" class="fondo-oscuro oculto"></div>



<!-- ðŸ”» Script: Mini carrito -->
<script>
  const iconoCarrito = document.querySelector('img[alt="Carrito"]');
  const miniCarrito = document.getElementById("mini-carrito");
  const fondoCarrito = document.getElementById("fondo-oscuro-carrito");
  const contenedorMini = document.getElementById("mini-carrito-items");

  iconoCarrito.addEventListener("click", () => {
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    contenedorMini.innerHTML = "";

    if (carrito.length === 0) {
      contenedorMini.innerHTML = "<p>Tu carrito estÃ¡ vacÃ­o.</p>";
    } else {
      carrito.forEach(producto => {
        const div = document.createElement("div");
        div.style.marginBottom = "10px";
        div.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px;">
            <img src="${producto.imagen}" alt="" style="width:50px;height:50px;object-fit:cover;border-radius:5px;">
            <div>
              <p style="margin:0;">${producto.nombre}</p>
              <small>$${producto.precio.toLocaleString('es-CO')} x ${producto.cantidad}</small>
            </div>
          </div>`;
        contenedorMini.appendChild(div);
      });
    }

    miniCarrito.classList.remove("oculto");
    fondoCarrito.classList.remove("oculto");
  });

  fondoCarrito.addEventListener("click", () => {
    miniCarrito.classList.add("oculto");
    fondoCarrito.classList.add("oculto");
  });
</script>

<!-- ðŸ”» Script: Contador de carrito -->
<script>
  function actualizarContadorCarrito() {
    const contador = document.getElementById("contadorCarrito");
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];

    const total = carrito.reduce((acc, prod) => acc + prod.cantidad, 0);

    if (total > 0) {
      contador.textContent = total;
      contador.style.display = "inline-block";
    } else {
      contador.style.display = "none";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    actualizarContadorCarrito();
  });
</script>

<div id="whatsapp"></div>
<script>
  fetch("whatsapp.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("whatsapp").innerHTML = html;
    });
</script>
 <!-- Footer -->
  <footer class="footer">
    <p>Â© 2025, MaxiKompras | <a href="index.html">PolÃ­tica de privacidad</a></p>
  </footer>

</body>
</html>
